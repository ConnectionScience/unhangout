<% include _header.ejs %>
<% include _navbar.ejs %>

<div class="jumbotron">
    <h1><img class="" src="/public/img/unhangout-logo.png" width="77px" height="68px"> Unhangouts </h1>

    <h3>Create an Unhangout <small>It's free and always will be.</small></h3>
</div>

<div class="container event-form-container">
    <br/>

    <form class="form-horizontal"
          action="/admin/event/<%= create ? 'new' : event.id %>"
          method="post" encoding="application/x-www-form-urlencoded">

    <div class="control-group">
        <label class="control-label" for="inputTitle">Event Title</label>
        <div class="controls">
            <input style="width: 560px;" type="text" id="inputTitle" name="title"
                   placeholder="Give your event a catchy title"
                   value="<%=create ? "":event.get("title") %>"
                   required>
        </div>
    </div>

    <div class="control-group">
        <label class="control-label" for="inputOrganizer">Event Organizer</label>
        <div class="controls">
            <input style="width: 560px;" type="text" id="inputOrganizer"
                   placeholder="Tell your attendees who is organizing this event"
                   name="organizer"
                   value="<%= create ? "" : event.get("organizer") %>">
        </div>
    </div>

    <div class="control-group">
        <label class="control-label" for="inputShortName">Event URL</label>
        <div class="controls">
            <input style="width: 300px;" type="text" id="eventURL"
                   placeholder="http://unhangout.media.mit.edu/event/" readonly>
            <input style="width: 242px;" type="text" id="inputShortName" name="shortName"
                   placeholder="event-url"
                   value="<%= create ? "" :event.get("shortName") %>">
        </div>
    </div>

    <div class="control-group">
        <label class="control-label" for="inputDate">Event Date/Time</label>
        <div class="controls">
            <div class="input-append date form_datetime">
                <input style="width: 532px;" size="16" type="text"
                       value="<%= create ? "" : event.get("dateAndTime") %>"
                       name="dateAndTime" id="dateAndTime" readonly>
                <span class="add-on"><i class="icon-th"></i></span>
            </div>
        </div>
    </div>

    <div class="control-group">
        <label id="tzLabel" class="control-label" for="timeZone">Time Zone</label>
        <div class="controls">
            <select id="timeZoneValue" style="width: 570px;" name="timeZoneValue"
                    class="form-control"
                    value="<%= create ? "" : event.get("timeZoneValue") %>">
                <option value=""></option>
                <!-- options created in script below -->
            </select> 
        </div>
    </div>

    <div class="control-group">
        <label class="control-label" for="inputWelcomeMessage">Welcome Message</label>
        <div class="controls">
            <textarea rows=1 cols=40 type="text" id="inputWelcomeMessage"
                      name="welcomeMessage" placeholder="Welcome Message for Participants"
                      style='width: 560px;'
                ><%= create ? "" : event.get("welcomeMessage") %></textarea>
        </div>
    </div>
    
    <div class="control-group">
        <label class="control-label" for="inputDescription">Event Description </label>
        <div class="controls">
            <div class="container">
                <textarea class="summernote" name="description" rows=5 style='width: 100%;'
                          required><%= create ? "" : event.cleanDescription() %></textarea>
            </div>
        </div>
    </div>

    <div class="control-group">
        <div class="controls">
            <button class="btn btn-primary create-event" type='submit'>
                <%= create? "Create My Unhangout Event": "Update My Event" %>
            </button>
        </div>
    </div>
            
    </form>
</div>

<!--<script type="text/javascript" src="/public/js/summernote.min.js"></script>-->
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jstimezonedetect/1.0.4/jstz.js"></script>
<script type="text/javascript" src="/public/js/bootstrap-datetimepicker.min.js"></script>

<script>
    $(function(){
        $(".form_datetime").datetimepicker({
            format: "MM dd, yyyy hh:ii",
            showMeridian: true,
            autoclose: true,
            pickerPosition: 'bottom-left',
            viewSelect: 'decade'
        });

        /*
        $('.summernote').summernote({
            toolbar: [
                ['style', ['bold', 'italic', 'underline', 'clear']],
                ['fontsize', ['fontsize']],
                ['color', ['color']],
                ['para', ['ul', 'ol', 'paragraph']],
                ['height', ['height']],
                ['insert', ['picture', 'link']], 
                ['codeview', ['codeview']],
            ],
            height: 150
        });
        */

        // Append timezones to option box.
        var zones = _.map(moment.tz.zones(), function(z) { return z.displayName; });
        zones.sort(function(a, b) {
            var aIsAmerica = /^America/.test(a);
            var bIsAmerica = /^America/.test(b);
            if (aIsAmerica != bIsAmerica) {
                return aIsAmerica ? -1 : 1;
            } else {
                return a < b ? -1 : a > b ? 1 : 0;
            }
        });
        var frag = document.createDocumentFragment();
        _.each(zones, function(zone) {
            var option = document.createElement("option");
            option.value = zone;
            option.textContent = zone.replace(/_/g, " ");
            if (zone === "<%= create ? "" : event.get("timeZoneValue") %>") {
                option.selected = true;
            }
            frag.appendChild(option);
        });
        $("#timeZoneValue").append(frag);
        
        

        if($("#timeZoneValue").val() == "") {
            var currentTimezone = 
            // Automatic TimeZone Detection of the browser client 
            $("#timeZoneValue").val(jstz.determine().name());
        }
        
        //Default date and time setting
        if($("#dateAndTime").val() == "") {
            // NB: moment uses a different format syntax from bootstrap-datetimepicker.
            var oneWeekAfter = moment()
                .add('days', 7)
                .second(0)
                .minute(0)
                .format("MMMM DD, YYYY HH:mm"); 
            $("#dateAndTime").val(oneWeekAfter);
        }
    });
</script>

<% include _footer.ejs %>
