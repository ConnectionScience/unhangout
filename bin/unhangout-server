#!/usr/bin/node

var winston = require('winston'),
	_ = require('underscore')._,
	server = require('../lib/unhangout-server.js');

// TODO switch this to a file. Had trouble with getting that working, though.
var logger= new (winston.Logger)({
    transports: [
		new (winston.transports.Console)(
			{
			timestamp: true
			})
    ],
});

logger.cli();

logger.info("Starting unhangout-server.");

// show all related env variables
var env = {};
_.each(process.env, function(value, key) {
	if(key.indexOf("UNHANGOUT_")!=-1) {
		env[key.slice(10)] = value;
	}
});

logger.info("env: " + JSON.stringify(env));

var s = new server.UnhangoutServer();
s.on("inited", function() {
	s.start();
});

s.init(_.extend(env, {"level":"debug", "transport":"console", "mock-auth":false}));
